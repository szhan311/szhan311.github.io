<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h1 id="preliminaries">Preliminaries</h1> <h2 id="machanics">Machanics</h2> <p>Curves: $\gamma(t): [0:1] \rightarrow \mathcal{X}$; Velocity $\dot{\gamma_t} \in \mathcal{T}<em>{\gamma(t)} \mathcal{X}$; Lagrangian function: $L(\gamma_t \dot{\gamma_t}, t)$ Given two endpoints $x_0, x_1 \in \mathcal{X}$, define the _<strong>action</strong></em> as the time integral $\mathcal{A}(\gamma)=\int_0^1 L\left(\gamma_t, \dot{\gamma}_t, t\right) d t$. Minimize the action along all curves: $c\left(x_0, x_1\right)=\inf _{\gamma \in \Pi\left(x_0, x_1\right)} \mathcal{A}(\gamma)=\inf _{\gamma_t} \int_0^1 L\left(\gamma_t, \dot{\gamma}_t, t\right) d t \quad$ Lagrangian flows: we refer to the optimizing curves $\gamma^*(x_0, x_0)$ as Lagrange flows, which satisfy the Euler-Lagrange equation $\frac{d}{d t} \frac{\partial}{\partial \dot{\gamma}_t} L\left(\gamma_t, \dot{\gamma}_t, t\right)=\frac{d}{d \gamma_t} L\left(\gamma_t, \dot{\gamma}_t, t\right)$ Assume that $L(\gamma_t, \dot{\gamma}_t, t)$ is strictly convex in the velocity $\dot{\gamma}_t$, then we can obtain an equivalent, Hamiltonian perspective. Define the Hamiltonian $H\left(\gamma_t, p_t, t\right)$ as the Legendre transform of $L$ with respect to $\dot{\gamma}_t$, $H\left(\gamma_t, p_t, t\right)=\sup _{\dot{\gamma}_t}\left\langle\dot{\gamma}_t, p_t\right\rangle-L\left(\gamma_t, \dot{\gamma}_t, t\right)$ The Euler-Lagrange equations can be written as Hamiltion’s equation in phase space $\dot{\gamma}_t=\frac{\partial}{\partial p_t} H\left(\gamma_t, p_t, t\right) \quad \dot{p}_t=-\frac{\partial}{\partial \gamma_t} H\left(\gamma_t, p_t, t\right)$</p> <h2 id="basic-of-math">Basic of math</h2> <p><strong>Deﬁnition (Image measure or push forward measure): **take a map $T:X \rightarrow Y$ and a probability measure $\mu \in \mathcal{P} (Y)$ as: $\left(T_{#} \mu\right)(A):=\mu\left(T^{-1}(A)\right)$ for any $A \in \mathcal{B}(Y)$ **Deﬁnition (Tangent space)</strong>: Given a point $p \in M$, the tangent space $T_p M \subset \mathbb{R}^D$ of $M$ at $p$ is defined as $T_p M:={\dot{\gamma}(0) \mid \gamma:(-1,1) \rightarrow M, \gamma(0)=p}$. Intuitively, the tangent space contains all the directions tangent to $M$ at $p$. <strong>Deﬁnition (Riemannian distance)</strong>: Given two points $x, y \in M$, their Riemannian distance $d_{M}(x, y)$ is defined as $d_M(x, y):=\inf \left{\int_a^b|\dot{\gamma}(t)| d t \mid \gamma:[a, b] \rightarrow M, \gamma(a)=x, \gamma(b)=y\right}$. $X$ and $Y$ are locally compact, separable, and complete metric spaces. <strong>Deﬁnition (Minimizing geodesic)</strong>: A curve $\gamma : [a,b] \rightarrow M$ with constant speed such that $\gamma(a) = x, \gamma(b) = y$, and whose length is equal to $d_M (x, y)$, is called a minimizing geodesic.</p> <h2 id="transport-maps--coupling">Transport maps &amp; coupling</h2> <p><strong>Definition (Transport map): **Given $\mu \in \mathcal{P}(X)$ and $v \in \mathcal{P}(Y)$, a map $T: X \rightarrow Y$ is called a transport map from $\mu$ to $v$ if $T_{#} \mu = v$ **Definition (Coupling or transport plan):</strong> We call $\gamma \in \mathcal{P}(X \times Y)$ a coupling of $\mu$ and $v$ if $\left(\pi_X\right)<em>{#} \gamma=\mu \quad \text { and } \quad\left(\pi_Y\right)</em>{#} \gamma=v \text {, }$where $\pi_X(x, y)=x, \quad \pi_Y(x, y)=y \quad \forall(x, y) \in X \times Y$. We denote by $\Gamma(\mu, v)$ the set of couplings of $\mu$ and $v$. <strong>Remark: **Given $\mu$ and $v$, the set $\Gamma(\mu, v)$ is always nonempty, indeed the product measure $\gamma = \mu \otimes v$ (defined by $\int \phi(x, y) d \gamma(x, y)=\int \phi(x, y) d \mu(x) d \nu(y)$) for every $\phi: X \times Y \rightarrow \mathbb{R}$ is a coupling. **Remark (Transport map vs. coupling)</strong>. Let $T: X \rightarrow Y$ satisfy $T_{#} \mu=v$. Consider the map$\operatorname{Id} \times T: X \rightarrow X \times Y$, i.e., $x \mapsto(x, T(x))$, and define$\gamma_T:=(\operatorname{Id} \times T)_{#} \mu \in \mathcal{P}(X \times Y)$, we claim that $\gamma_T \in \Gamma(\mu, v)$. This proves that any transport map $T$ includes a coupling $\gamma_T$.</p> <h2 id="optimal-transport">Optimal Transport</h2> <p>Two kinds of formulation: <strong>Monge</strong> formulation and <strong>Kantorovich</strong> formulation</p> <h1 id="sketch">Sketch</h1> <h2 id="how-to-calculate-the-action-of-rho_t">How to calculate the action of $\rho_t$</h2> <p>Given Lagrangian function $\mathcal{L}\left[\rho_t, \dot{\rho}<em>t, t\right]$, the action is $A_L[\rho_t]=\int_0^1 \mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right] d t$ Recall the definition of the Legendre transform for $\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]$ strictly convex in $\dot{\rho}_t$, $\begin{aligned} &amp; \mathcal{H}\left[\rho_t, s_t, t\right]=\sup _{\dot{\rho}_t \in \mathcal{T}</em>{\rho_t} \mathcal{P}} \int \dot{\rho}<em>t s_t d x_t-\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right] \ &amp; \mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]=\sup _{s_t \in \mathcal{T}</em>{\rho_t}^* \mathcal{P}} \int \dot{\rho}<em>t s_t d x_t-\mathcal{H}\left[\rho_t, s_t, t\right]\end{aligned}$ The action $A_L[\rho_t]$ is the solution to the inneroptimization $\mathcal{A}</em>{\mathcal{L}}\left[\rho_t\right]=\sup _{s_t} \int s_1 \mu_1 d x_1-\int s_0 \mu_0 d x_0-\int_0^1\left(\int \frac{\partial s_t}{\partial t} \rho_t d x_t+\mathcal{H}\left[\rho_t, s_t, t\right]\right) d t$</p> <h2 id="how-to-minimize-the-action">How to minimize the action</h2> <p>The optimization$\mathcal{S}=\inf <em>{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \mathcal{A}<em>{\mathcal{L}}\left[\rho_t\right]=\inf _{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \int_0^1 \mathcal{L}\left[\rho_t, \dot{\rho}<em>t, t\right] d t$ is equivalent to the following dual $\mathcal{S}=\inf _{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \sup _{s_t} \int s_1 \mu_1 d x_1-\int s_0 \mu_0 d x_0-\int_0^1\left(\int \frac{\partial s_t}{\partial t} \rho_t d x_t+\mathcal{H}\left[\rho_t, s_t, t\right]\right) d t$ So we have two goals</p> <ul> <li> <strong>Inner optimization:</strong> evaluating the action functional $\mathcal{A}_{\mathcal{L}}\left[\rho_t\right]$ for a given curve $\rho_t$</li> <li>**Outer optimization: **optimizing the action over curves $\rho_t \in \Gamma\left(\left{\mu_{t_i}\right}\right)$ satisfying the desired constraints</li> <li> <img src="https://cdn.nlark.com/yuque/0/2023/png/27584564/1699852344709-9869240a-0a0a-4e77-8037-81845f1ab2c3.png#averageHue=%23fbfaf9&amp;clientId=u65838f34-583e-4&amp;from=paste&amp;height=340&amp;id=G50QW&amp;originHeight=477&amp;originWidth=1160&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=199088&amp;status=done&amp;style=none&amp;taskId=u0238505c-5d95-4336-8f67-cd3e4ca38fe&amp;title=&amp;width=826" alt="image.png"> <h2 id="hamiltonian-optimality-conditions">Hamiltonian optimality conditions</h2> <p>$\frac{\partial \rho_t}{\partial t}=\frac{\delta}{\delta s_t} \mathcal{H}\left[\rho_t, s_t, t\right]$and $\frac{\partial s_t}{\partial t}=-\frac{\delta}{\delta \rho_t} \mathcal{H}\left[\rho_t, s_t, t\right]$</p> <h1 id="a-special-class-of-lagrangians">A special class of Lagrangians</h1> <p>Definition 3.1 ((Dual) Linearizability). A Lagrangian $\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]$ is dual linearizable if the corresponding Hamiltonian $\mathcal{H}\left[\rho_t, s_t, t\right]$ can be written as a linear functional of the density $\rho_t$. In other words, $\mathcal{H}\left[\rho_t, s_t, t\right]$ is linearizable if there exist functions $K^<em>\left(x_t, s_t, t\right)$, and $U\left(x_t, s_t, t\right)$ such that $\mathcal{H}\left[\rho_t, s_t, t\right]=\int\left(K^</em>\left(x_t, s_t, t\right)+U\left(x_t, s_t, t\right)\right) \rho_t d x_t$</p> <h1 id="parameterization">Parameterization</h1> <p>We parameterize $s_t$ as a neural network $s_t(x, \theta)$, we parameterize the distribution path $\rho_t(x, \eta)$ as a generative model $x_t=(1-t) x_0+t x_1+t(1-t) \mathrm{NNET}\left(t, x_0, x_1, \eta\right), \quad x_0 \sim \mu_0, \quad x_1 \sim \mu_1$.</p> <h2 id="reparameterization-trick">Reparameterization trick</h2> <p>For linearizable dual objectives, we optimize $\begin{aligned} \operatorname{LOSS}(\theta, \eta)=\min _\eta \max _\theta \int s_1(x, \theta) \mu_1 d x_1-\int s_0(x, \theta) \mu_0 d x_0 \ \quad-\int_0^1 \int\left(\frac{\partial s_t}{\partial t}(x, \theta)+K^<em>\left(s_t(x, \theta), t\right)+U\left(s_t(x, \theta), t\right)\right) \rho_t(x, \eta) d x d t\end{aligned}$ Given this objective, we see that minimizing $\eta$ and maximizing $\theta$ are seperatable. An alternative to parametrizing the distribution path $\rho_t$ is perform minimization of the LOSS via the Wasserstein gradient flow $x_t^{\prime}=x_t+\alpha \cdot t(1-t) \nabla_x\left[\frac{\partial s_t}{\partial t}\left(x_t, \theta\right)+K^</em>\left(s_t\left(x_t, \theta\right), t\right)+U\left(s_t\left(x_t, \theta\right), t\right)\right]$</p> <h2 id="algorithm">Algorithm</h2> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/27584564/1699855255705-28c77fbc-0f50-4140-9ebe-fa296b5e2965.png#averageHue=%23eeeeee&amp;clientId=u65838f34-583e-4&amp;from=paste&amp;height=318&amp;id=J95gc&amp;originHeight=504&amp;originWidth=1177&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=143483&amp;status=done&amp;style=none&amp;taskId=u0e294a81-e410-487f-bb00-11fb2e0db96&amp;title=&amp;width=742.5" alt="image.png"></p> </li> </ul> <h1 id="wassertein-2-geometry">Wassertein-2 Geometry</h1> <h2 id="definition">Definition</h2> <p>Given two densities with finite second moments $\mu_0, \mu_1 \in \mathcal{P}_2(\mathcal{X})$, the Wassertein-2 OT problem is defined , in the Kantorovich formulation, as a cost-minimization problem over joint distributions $\pi \in \Pi\left(\mu_0, \mu_1\right)=\left{\pi\left(x_0, x_1\right) \mid \int \pi\left(x_0, x_1\right) d x_1=\mu_0, \int \pi\left(x_0, x_1\right) d x_0=\mu_1\right}$, i.e. $W_2\left(\mu_0, \mu_1\right)^2:=\inf _{\pi \in \Pi\left(\mu_0, \mu_1\right)} \int\left|x_0-x_1\right|^2 \pi\left(x_0, x_1\right) d x_0 d x_1$</p> <h2 id="an-alternative-perspective-dynamical-formulation">An alternative perspective (dynamical formulation)</h2> <p>An alternative perspective on the $W_2$ OT problem as an optimization over a vector field $v_t$ that transports samples according to an ODE $\dot x_t = v_t$. The evolution of samples’ density $\rho_t$, under transport by $v_t$, is governed by the continuity equation $\dot{\rho}_t = - \nabla \cdot (\rho_t v_t)$, and we have $W_2\left(\mu_0, \mu_1\right)^2=\inf _{\rho_t} \inf _{v_t} \int_0^1 \int \frac{1}{2}\left|v_t\right|^2 \rho_t d x_t d t \quad$ s.t. $\dot{\rho}_t=-\nabla \cdot\left(\rho_t v_t\right), \quad \rho_0=\mu_0, \rho_1=\mu_1$ where $\nabla \cdot ()$ is the divergence operator. The $W_2$ transport cost can be viewed as providing a Riemannian mannifold structure on the space of densities $\mathcal{P}_2(\mathcal{X})$</p> <h1 id="wassertein-fisher-rao-geometry">Wassertein Fisher-Rao Geometry</h1> <ul> <li>consider additional terms allowing for birth and death of particles</li> </ul> <p>Extending the continuity equation to include a ‘growth term’ $g_t: \mathcal{X}, \rightarrow \mathbb{R}$, the objective is $W F R_\lambda\left(\mu_0, \mu_1\right)^2=\inf <em>{\rho_t} \inf _{v_t, g_t} \int_0^1 \int\left(\frac{1}{2}\left|v_t\right|^2+\frac{\lambda}{2} g_t^2\right) \rho_t d x_t d t$ subject to $\dot{\rho}_t=-\nabla \cdot\left(\rho_t v_t\right)+\lambda \rho_t g_t, \rho_0=\mu_0, \rho_1=\mu_1$ We call this the _<strong>Wasserstein Fisher-Rao (WFR)</strong></em> distance, this problem is reffered as <strong>unbalanced OT problem</strong></p> <h2 id="a-riemanian-structure-on-mathcalmmathcalx">A Riemanian structure on $\mathcal{M}(\mathcal{X})$</h2> <p>A Riemanian structure on $\mathcal{M}(\mathcal{X})$ via the WFR distance. Introducting Lagrange multipliers $s_t$ and eliminating $v_t$, $g_t$ yields the optimality conditions $v_t = \nabla s_t$ and $g_t = s_t$. This suggests characterizing the tangent space via the tuple $\left(s_t, \nabla s_t\right)$ and define the metric as $\begin{aligned} T_\rho^{W F R_\lambda} \mathcal{M}(\mathcal{X}) &amp; ={\dot{\rho} \mid \dot{\rho}=-\nabla \cdot(\rho \nabla s)+\lambda \rho s} \ \left\langle\dot{\mu}<em>t, \dot{\rho}_t\right\rangle</em>{T_\rho}^{W F R_\lambda} &amp; =\left\langle s_{\dot{\mu}<em>t}, s</em>{\dot{\rho}<em>t}\right\rangle</em>{T_\rho^*}^{W F R_\lambda}=\int\left(\left\langle\nabla s_{\dot{\mu}<em>t}, \nabla s</em>{\dot{\rho}<em>t}\right\rangle+\lambda s</em>{\dot{\mu}<em>t} s</em>{\dot{\rho}_t}\right) \rho d x .\end{aligned}$</p> <h1 id="action-matching">Action Matching</h1> <p>The objective is $\mathcal{A}\left[\mu_t\right]=\sup <em>{s_t} \int s_1 \mu_1 d x_1-\int s_0 \mu_0 d x_0-\int_0^1 \int\left(\frac{\partial s_t}{\partial t}+\frac{1}{2}\left|\nabla s_t\right|^2\right) \mu_t d x_t d t$ $s_t: \mathcal{X}\times [0, 1] \rightarrow \mathbb{R}$ is parameterized by a neural network, with similar objective for $WFR</em>{\lambda}$ we view Action Matching as maximizing a lower bound on the action $\mathcal{A}[\mu_t]$ or kinetic energy of the curve $\mu_t : [0, 1] \rightarrow \mathcal{P}<em>2(\mathcal{X})$ of densities. In particular, at those optimal $s</em>{\dot{\mu_t}}$ satisfying $\dot{\mu}<em>t=-\nabla \cdot\left(\mu_t \nabla s</em>{\dot{\mu}<em>t}\right)$, $\mathcal{A}\left[\mu_t\right]=\int_0^1 \frac{1}{2}\left\langle\dot{\mu}_t, \dot{\mu}_t\right\rangle</em>{T_{\mu_t}}^{W_2} d t=\int_0^1 \frac{1}{2}\left\langle s_{\dot{\mu}<em>t}, s</em>{\dot{\mu}<em>t}\right\rangle</em>{T_{\mu_t}^*}^{W_2} d t=\int_0^1 \int \frac{1}{2}\left|\nabla s_t\right|^2 \mu_t d x_t d t$</p> <h1 id="wassertein-lagrangian-flows">Wassertein Lagrangian Flows</h1> <h2 id="wassertein-lagrangian-and-hamiltonian-flows">Wassertein Lagrangian and Hamiltonian Flows</h2> <p>$\mathcal{L}\left[\rho_t, \dot{\rho}<em>t, t\right]=\mathcal{K}\left[\rho_t, \dot{\rho}_t, t\right]-\mathcal{U}\left[\rho_t, t\right]$ define the action of a curve: $\mathcal{A}(\rho_t)=\int_0^1 L\left(\rho_t, \dot{\rho}_t, t\right) d t$. seek the action-minimizing curve subject to the constraints: $\begin{aligned} \mathcal{S}</em>{\mathcal{L}}\left(\left{\mu_{t_i}\right}<em>{i=0}^{M-1}\right) &amp; :=\inf _{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \mathcal{A}<em>{\mathcal{L}}\left[\rho_t\right] \ &amp; :=\inf _{\rho_t} \int_0^1 \mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right] d t \quad \text { s.t. } \rho</em>{t_i}=\mu_{t_i} \quad \forall 0 \leq i \leq M-1\end{aligned}$ where $\Gamma\left(\left{\mu_{t_i}\right}\right)=\left{\rho_t:[0,1] \rightarrow \mathcal{P}(\mathcal{X}) \mid \rho_0=\mu_0, \rho_1=\mu_1, \rho_{t_i}=\mu_{t_i} \quad(\forall 1 \leq i \leq M-2)\right}$ Define the Hamiltonian via Legendre transform: $\mathcal{H}\left[\rho_t, s_t, t\right]=\sup <em>{\dot{\rho}_t \in T</em>{\rho_t} \mathcal{P}} \int \dot{\rho}<em>t s_t d x_t-\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]=\mathcal{K}^*\left[\rho_t, s_t, t\right]+\mathcal{U}\left[\rho_t, t\right]$ Finally, $\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]$ can be written using the Legendre transform $\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]=\sup _{s_t \in T</em>{\rho_t}^* \mathcal{P}} \int \dot{\rho}<em>t s_t d x_t-\mathcal{H}\left[\rho_t, s_t, t\right]$ The following theorem forms the basis for our computational approach Theorem 1. For a Lagrangian $\mathcal{L}\left[\rho_t, \dot{\rho}_t, t\right]$ which is lsc and strictly convex in $\dot{\rho}_t$, the optimization $\mathcal{S}=\inf _{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \mathcal{A}<em>{\mathcal{L}}\left[\rho_t\right]=\inf _{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \int_0^1 \mathcal{L}\left[\rho_t, \dot{\rho}<em>t, t\right] d t$ is equivalent to the following dual $\mathcal{S}=\inf _{\rho_t \in \Gamma\left(\left{\mu</em>{t_i}\right}\right)} \sup _{s_t} \int s_1 \mu_1 d x_1-\int s_0 \mu_0 d x_0-\int_0^1\left(\int \frac{\partial s_t}{\partial t} \rho_t d x_t+\mathcal{H}\left[\rho_t, s_t, t\right]\right) d t$ Next, we have Wasserstein Hamiltonian flows satisfy the optimality conditions $\frac{\partial \rho_t}{\partial t}=\frac{\delta}{\delta s_t} \mathcal{H}\left[\rho_t, s_t, t\right]$and $\frac{\partial s_t}{\partial t}=-\frac{\delta}{\delta \rho_t} \mathcal{H}\left[\rho_t, s_t, t\right]$</p> <p>#</p> </body></html>